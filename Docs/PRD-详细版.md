# AI互动叙事小说游戏详细产品需求文档

## 1. 产品概述

### 1.1 产品定义
AI互动叙事小说游戏是一款基于AI生成技术的互动文字冒险游戏，玩家可以在多种世界框架中体验个性化的故事冒险。游戏通过AI实时生成故事内容和分支选项，确保每次游戏体验的独特性和高度可重玩性。

### 1.2 产品背景
随着AI生成内容技术的发展，传统互动小说的固定剧情和有限分支已无法满足用户对个性化、多样化叙事体验的需求。本产品旨在结合AI的创造力与传统互动小说的叙事结构，打造一个动态生成、高度个性化的叙事平台。

### 1.3 产品愿景
成为AI叙事游戏领域的先驱者，建立一个可持续发展的叙事生态系统，让玩家能够在无限可能的故事世界中探索，体验独一无二的冒险。

### 1.4 产品目标
- 为玩家提供高质量、个性化的AI生成故事体验
- 建立可持续的商业模式，通过虚拟货币、VIP会员和框架包销售实现盈利
- 打造活跃的用户社区，促进用户创作和分享
- 不断扩展游戏世界观和叙事可能性

## 2. 用户分析

### 2.1 目标用户群体
- **叙事探索者**：喜爱文字冒险和互动小说的玩家，年龄18-45岁，寻求高质量的故事体验
- **休闲游戏玩家**：平均每天游戏1-2小时，偏好移动设备上的游戏体验
- **AI技术爱好者**：对AI生成内容感兴趣，愿意尝试新技术和新体验
- **幻想文学爱好者**：喜爱奇幻、科幻等类型文学的读者，寻求深度的世界观体验

### 2.2 用户痛点
- 传统互动小说的固定剧情导致重玩价值低
- 现有游戏中的二元选择过于简单，缺乏复杂性和个性化
- 对个人体验和独特故事的渴望
- 现有文字游戏叙事深度和世界观构建不足

### 2.3 用户需求
- 高度个性化的故事体验
- 丰富多样的世界框架和剧情发展
- 复杂的决策系统和个性塑造
- 多终端同步的游戏进度
- 社区分享和体验交流

## 3. 核心系统需求

### 3.1 世界框架系统

#### 3.1.1 框架类别
系统支持7大框架类别，每个类别包含多个框架元素：
- **世界观**：基本世界设定，如奇幻世界、蒸汽朋克等
- **时代背景**：故事发生的时代，如近未来、中世纪等
- **科技水平**：世界的科技发展程度
- **魔法体系**：若有魔法，其基本规则和形式
- **主要种族**：世界中的主要种族和生物
- **政治体系**：社会组织形式和权力结构
- **主要冲突**：驱动故事的核心矛盾和冲突

#### 3.1.2 框架组合机制
- 支持多种框架元素自由组合，创造独特世界观
- 某些特定组合可解锁隐藏框架特性
- 玩家可保存自定义框架组合作为模板

#### 3.1.3 框架解锁系统
- 免费用户可使用基础框架
- 通过虚拟货币解锁高级框架
- VIP会员可免费使用所有普通框架
- 特殊框架只能通过组合包获得

#### 3.1.4 框架预览功能
- 展示框架简介和主要特点
- 提供框架风格
- 显示框架解锁条件和价格

### 3.2 AI叙事引擎

#### 3.2.1 故事生成系统
- 基于选定框架和玩家选择生成连贯、个性化的故事内容
- 确保生成内容与已有故事保持一致性
- 支持多种叙事风格和情感基调
- 故事字数控制在200-300字，保持阅读流畅性

#### 3.2.2 玩家选择系统
- 提供2-3个符合逻辑的选项
- 基于玩家历史选择和行为评分调整选项内容
- 确保选项合理性，避免出现不符合场景的选择

#### 3.2.3 动态分支系统
- 根据玩家选择实时调整故事走向
- 支持长期故事分支和短期选择影响
- 基于行为评分系统调整故事发展

#### 3.2.4 战斗场景系统
- 提供基于文字描述的战斗场景
- 战斗过程分为多个回合（4-8回合）
- 根据战斗进展和玩家策略动态调整战局
- 支持多种战斗结果（胜利、失败、撤退、谈判）

#### 3.2.5 行为评分系统
- 记录六大维度的玩家行为倾向：
  - 道德（morality）
  - 冒险（adventure）
  - 社交（social）
  - 智力（intelligence）
  - 权力（power）
  - 生存（survival）
- 分数范围：-100至+100
- 每次选择对评分的影响范围：-2至+2
- 评分影响后续剧情走向和NPC反应

### 3.3 用户账号与资产系统

#### 3.3.1 账号系统
- 支持邮箱注册和登录
- 支持Google等第三方账号登录
- 支持匿名账号创建和后续升级
- 账号信息安全存储与加密

#### 3.3.2 虚拟货币系统
- 双货币系统：金币和钻石
- 金币：主要用于购买普通框架，可通过日常活动获得
- 钻石：高级货币，用于购买高级框架和VIP会员，可通过充值获得
- 支持货币充值和消费记录查询

#### 3.3.3 VIP会员系统
- 月度会员制
- 会员权益：
  - 解锁所有普通框架使用权
  - 增加存档数量上限
  - 移除广告（如有）
- 自动续费和管理机制

#### 3.3.4 资产安全系统
- 关键操作二次确认
- 购买记录和消费日志
- 异常操作监控和风控系统
- 资产恢复和回滚机制

### 3.4 存档与同步系统

#### 3.4.1 存档管理
- 自动存档：每完成一个关键剧情节点自动保存
- 存档限制：普通用户5个，VIP用户20个
- 存档预览：显示存档时间、故事概要和使用的框架

#### 3.4.2 云同步机制
- 自动同步存档到云端
- 支持多设备同步游戏进度
- 断网状态下本地存档，联网后自动同步
- 冲突解决机制，避免数据丢失

#### 3.4.3 存档导出与分享（可选）
- 支持特定存档点导出为分享链接
- 其他玩家可通过链接体验相同的故事节点
- 分享内容包含故事背景和当前状态，但不含个人资产信息

### 3.5 商店系统

#### 3.5.1 框架购买
- 分类展示可购买的框架
- 支持按类别、价格、热度等筛选
- 框架详情页显示说明、效果预览和用户评价
- 支持一键购买和添加到愿望清单

#### 3.5.2 组合包
- 提供多个高级框架的优惠组合包
- 特定主题的框架集合（如"科幻大师包"）

#### 3.5.3 VIP会员购买
- 提供月度会员
- 显示会员特权
- 支持自动续费和取消设置

#### 3.5.4 订单管理
- 完整的购买记录和订单历史
- 消费统计和分析
- 订单问题处理和退款申请

## 4. 界面与交互需求

### 4.1 整体风格
- 暗色系主题，营造沉浸式阅读体验
- 优雅简洁的字体，确保长时间阅读舒适度
- 风格化的UI元素，与游戏世界观保持一致
- 响应式设计，适配不同屏幕尺寸和设备

### 4.2 主要界面

#### 4.2.1 首页(Home)
- 游戏标题和品牌展示
- 登录/注册入口
- "开始游戏"和"继续游戏"主按钮
- 最新公告和活动信息
- 设置和帮助入口
- 神秘声音互动组件，增强游戏氛围

#### 4.2.2 大厅(Lobby)
- 用户信息和资产展示
- 世界框架选择界面(开始游戏)
- 存档列表和管理
- 个人资料设置
- 商店入口
- 云同步状态指示

#### 4.2.3 商店(Shop)
- 框架分类导航
- 框架列表和详情展示
- VIP会员专区
- 组合包推荐
- 虚拟货币余额和充值入口
- 订单历史入口

#### 4.2.4 游戏主界面
- 故事内容展示区域
- 玩家选项列表
- 角色状态和信息面板
- 快速保存按钮
- 设置和退出按钮
- 战斗状态指示（战斗时显示）

### 4.3 交互设计

#### 4.3.1 响应式适配
- 移动设备：触摸优化，单手操作友好
- 平板：优化阅读体验和交互区域
- 桌面：支持键盘导航和快捷键

#### 4.3.2 手势支持
- 滑动翻页/滚动故事
- 点击选择选项
- 长按显示选项详情（如有）
- 双指缩放调整文字大小

#### 4.3.3 过渡动画
- 页面切换平滑过渡
- 故事加载动画
- 选项选择反馈动画
- 战斗效果文字动画

#### 4.3.4 错误处理
- 网络错误提示和重试机制
- 操作失败反馈和恢复建议
- 系统错误友好提示
- 掉线重连自动恢复

## 5. 非功能需求

### 5.1 性能要求
- 主界面首次加载时间：≤3秒（正常网络条件下）
- 用户操作响应时间：≤100ms
- AI生成内容平均响应时间：≤5秒，最长不超过10秒
- 内存占用：移动设备≤200MB
- 网络传输数据量：每次交互≤50KB

### 5.2 兼容性要求
- **浏览器支持**：
  - Chrome 90+
  - Safari 14+
  - Firefox 88+
  - Edge 90+
- **设备支持**：
  - iOS 13+
  - Android 9+
  - Windows 10+
  - macOS 10.14+
- **屏幕尺寸**：
  - 最小宽度：320px（移动设备）
  - 最佳体验宽度：768px+

### 5.3 安全要求
- **数据安全**：
  - 用户密码加密存储（bcrypt或同等安全标准）
  - 敏感信息传输加密（HTTPS）
  - 数据存储加密和签名机制
- **账号安全**：
  - 登录异常监控和警告
  - 防暴力破解机制
  - 会话管理和安全策略
- **内容安全**：
  - AI生成内容过滤机制
  - 不适当内容自动检测和处理
  - 用户反馈和内容举报系统

### 5.4 可用性要求
- 系统可用性：99.9%（每月允许不超过44分钟的计划外停机时间）
- 多语言支持：初期支持中文，后续可扩展其他语言
- 无障碍设计：支持基础的无障碍功能（如文字大小调整）
- 离线功能：支持有限的离线游戏，联网后自动同步

## 6. 游戏流程

### 6.1 新用户首次体验流程
1. 进入首页，游戏demo展示
2. 用户选择登入方式登入
3. 创建匿名账号或登录已有账号
4. 进入大厅
5. 点击世界选择按钮打开世界框架选择界面
6. 选择世界框架（或使用默认推荐）7个主框架底下的子框架各选一个
7. 系统生成初始故事和选项
8. 玩家做出第一个选择
9. 系统生成后续故事内容
10. 完成一段故事后自动保存进度

### 6.2 存档加载流程
1. 用户登录账号
2. 进入大厅，查看存档列表
3. 选择想要继续的存档
4. 加载存档，展示故事概要
5. 继续游戏体验

### 6.3 框架购买流程
1. 用户进入商店
2. 浏览框架类别，查看详情
3. 选择要购买的框架，查看价格
4. 确认购买，支付虚拟货币
5. 系统更新用户拥有的框架
6. 用户可立即使用新框架创建故事

### 6.4 VIP会员购买流程
1. 用户查看VIP会员权益介绍
2. 选择购买VIP会员套餐月度
3. 选择支付方式(仅钻石)
4. 确认支付信息
5. 完成支付后更新会员状态
6. 系统立即激活VIP特权

### 6.5 战斗流程
1. 触发战斗场景（由故事发展或玩家选择触发）
2. 系统生成战斗初始状态和描述
3. 展示战斗选项（通常2-4个）
4. 玩家选择战斗策略
5. 系统生成战斗回合结果
6. 重复步骤3-5，直到达到结束条件
7. 生成战斗总结和结果
8. 返回正常故事流程

## 7. 数据需求

### 7.1 用户数据
- **基本信息**：
  - 用户ID（唯一标识）
  - 邮箱/第三方账号信息
  - 显示名称
  - 注册时间和最后登录时间
- **账号状态**：
  - 账号类型（邮箱/Google/匿名）
  - VIP会员状态和到期时间
  - 账号状态（正常/受限/封禁）
- **资产数据**：
  - 金币数量
  - 钻石数量
  - 拥有的框架列表
  - 交易记录
- **偏好设置**：
  - 界面设置（字体大小等）
  - 通知设置
  - 隐私设置

### 7.2 框架数据
- **基本信息**：
  - 框架ID和类别
  - 名称和描述
  - 创建时间和更新时间
- **属性**：
  - 类型（普通/高级）
  - 价格信息（金币/钻石）
  - VIP状态（是否VIP专属）
  - 所属组合包（如适用）
- **内容数据**：
  - 框架详细设定
  - 特殊规则和效果

### 7.3 存档数据
- **基本信息**：
  - 存档ID
  - 创建时间和最后修改时间
  - 标题和简介（用户可编辑）
- **游戏状态**：
  - 使用的框架组合
  - 当前故事进度百分比
  - 故事摘要历史
  - 当前和历史行为评分
- **角色状态**：
  - 收集的物品和技能
  - 关系网络
  - 已完成和进行中的任务
- **技术数据**：
  - 游戏版本
  - 创建设备信息
  - 同步状态

### 7.4 订单数据
- **基本信息**：
  - 订单ID
  - 用户ID
  - 创建时间和状态更新时间
- **商品信息**：
  - 商品类型（框架/VIP会员/组合包）
  - 商品ID和名称
  - 数量和单价
- **支付信息**：
  - 支付方式
  - 支付金额和货币类型
  - 交易ID和参考信息
- **状态信息**：
  - 订单状态（待支付/已完成/已取消/退款中/已退款）
  - 状态变更历史
  - 备注和客服记录

## 8. 技术架构要求

### 8.1 前端架构
- **技术栈**：
  - **TypeScript**：采用TypeScript实现类型安全和更好的代码质量
  - **React**：采用React函数组件和Hooks实现UI渲染和状态管理
  - **SCSS预处理器**：采用SCSS和BEM命名规范实现样式隔离
  - 响应式设计，支持移动和桌面设备
- **架构模式**：
  - 模块化设计，基于功能和职责的明确分离
  - 基于Context API和自定义Hooks的状态管理方案
  - 事件驱动架构，通过事件总线实现模块解耦
- **核心模块**：
  - 认证模块（AuthService）：处理用户登录、注册和会话管理
  - 缓存管理（CacheManager）：多级缓存策略，支持离线和性能优化
  - 事件系统（EventBus）：统一事件派发和监听机制
  - UI组件库：基于React组件的可复用UI系统
  - 游戏状态管理（GameStateManager）：管理游戏主要状态和存档
  - AI服务通信模块（AIService）：处理与AI服务的通信和响应解析

### 8.2 后端服务
- **核心服务**：
  - **Firebase**：作为主要后端服务提供身份验证、数据存储和云同步
  - 自定义API服务处理AI请求和特殊逻辑
- **数据存储**：
  - Firebase Firestore：用于用户数据和游戏状态的NoSQL数据库
  - Firebase Storage：用于大型数据存储
  - Firebase Authentication：用户身份验证系统
- **安全规则**：
  - 严格的数据访问控制规则
  - 服务端验证关键操作
  - 数据加密和安全传输

### 8.3 AI服务
- **服务接口**：
  - 基于REST API的AI服务调用
  - 支持异步响应和webhook回调
- **故障处理**：
  - 完善的重试机制和指数退避策略
  - 本地缓存和失败降级方案
- **AI模型要求**：
  - 支持上下文理解和连贯叙事
  - 能够遵循格式约束和输出结构化数据
  - 控制生成内容的长度和主题

### 8.4 存储策略
- **多级缓存**：
  - 内存缓存（短期数据）
  - 本地存储（会话和用户数据）
  - 云存储（长期和共享数据）
- **数据同步**：
  - 实时数据同步（关键状态）
  - 批量数据同步（大型数据集）
  - 离线操作队列和冲突解决
- **数据安全**：
  - 数据加密存储
  - 数据完整性验证
  - 敏感数据处理策略

## 9. 术语表

| 术语 | 定义 |
|------|------|
| 框架 | 游戏世界构建的基本元素，分为七大类别 |
| 普通框架 | 基础框架，VIP会员可使用全部 |
| 高级框架 | 特殊框架，需单独购买或通过组合包获得 |
| VIP会员 | 月费会员服务，提供所有普通框架使用权和额外特权 |
| 组合包 | 多个高级框架的打包销售 |
| 金币 | 基础虚拟货币，用于购买普通框架 |
| 钻石 | 高级虚拟货币，用于购买高级框架和VIP会员 |
| 存档 | 游戏进度保存点，包含故事状态和选择历史 |
| 行为评分 | 记录玩家行为倾向的六维度评分系统 |
| 战斗场景 | 基于文字的回合制战斗系统 |
| AI叙事引擎 | 负责生成故事内容和选项的核心系统 |

## 10. 技术实现详情

### 10.1 技术栈与框架

本项目严格使用以下技术栈进行开发：

- **核心技术**：
  - **TypeScript 5.0+**：利用强类型系统提升代码质量和可维护性
  - **React 18+**：采用最新版本React，使用函数组件与Hooks架构
  - **Firebase 9+**：使用模块化Firebase SDK管理后端服务

- **状态管理**：
  - **React Context + Hooks**：轻量级状态管理方案
  - **自定义hooks**：封装业务逻辑，提高代码复用性
  - **不使用Redux**：避免额外的学习成本和样板代码

- **UI与样式**：
  - **SCSS预处理器**：实现样式的编写和管理，使用格式为`ComponentName.scss`
  - **BEM命名规范**：确保样式模块化和隔离，格式为`.block__element--modifier`
  - **SCSS变量**：动态样式，统一管理颜色、字体等样式变量
  - **响应式设计**：基于媒体查询的多设备适配

#### 10.2.1 状态管理与数据流

- **Context Provider模式**：各功能模块提供独立Context
- **状态隔离与共享**：按功能模块划分状态，避免全局状态过大
- **单向数据流**：遵循React推荐的自上而下数据传递模式
- **乐观UI更新**：先更新UI，再异步持久化，提升体验流畅度

#### 10.2.2 性能优化策略

- **代码分割**：使用React.lazy和Suspense实现组件懒加载
- **缓存优化**：使用useMemo和useCallback缓存计算结果和回调函数
- **虚拟列表**：长列表使用窗口化技术，仅渲染可视区域
- **防抖与节流**：优化高频事件处理（如滚动、调整大小等）

#### 10.2.3 离线支持与数据同步

- **Firestore离线持久化**：关键游戏数据使用Firebase Firestore持久化，支持离线访问
- **操作队列**：离线操作记录与排队，联网后自动同步
- **冲突解决**：基于时间戳和版本号的数据冲突检测与解决
- **渐进式数据加载**：优先加载关键数据，后台异步加载次要数据

### 10.3 开发规范与最佳实践

- **代码风格**：使用ESLint+Prettier，遵循TypeScript严格模式
- **组件设计**：遵循单一职责原则，组件功能聚焦且可复用
- **注释规范**：关键逻辑和复杂算法必须有详细注释
- **版本控制**：Git分支管理，遵循语义化版本规范

### 10.4 部署与发布

- **构建工具**：使用Vite实现快速开发和优化构建
- **CI/CD**：接入GitHub Actions自动化构建和部署
- **监控系统**：接入错误监控和性能监控
- **更新策略**：支持增量更新和热更新 
