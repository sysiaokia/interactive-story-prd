# 新主页产品需求文档（PRD）

## 一、产品定位
新主页是AI叙事互动小说游戏的统一入口，负责用户认证、神秘声音与玩家选项交互演示（mysterious-voice.js、player-choices.js）、主操作按钮、底部登录注册入口等核心功能，要求风格统一、响应式、事件驱动、全新实现。

## 二、核心功能
1. **用户认证与入口**
   - 支持邮箱注册、邮箱登录、Google登录、匿名登录。
   - 认证状态检测，未登录自动跳转登录页。
   - 认证异常、会话失效自动清理缓存并提示。
   - 认证切换、登出、匿名升级等流程完整。
2. **神秘声音与玩家选项交互演示**
   - 通过 mysterious-voice.js 展示主提示语、打字动画、声波特效。
   - 通过 player-choices.js 展示玩家可选项，按钮交互，选项与神秘声音联动。
   - 该部分为游戏世界观和交互Demo，不是FAQ或帮助说明。
   - 所有交互均为事件驱动，UI与业务解耦。
3. **主操作按钮区**
   - 包含"继续探索这个世界""我需要更多的信息"等主操作按钮。
   - 按钮风格统一，支持键盘、触屏、鼠标等多种交互。
4. **底部入口**
   - 提供登录、注册、匿名访问等入口。
   - 所有入口按钮组件化，事件驱动。
5. **响应式布局与降级**
   - 适配手机、平板、桌面。
   - 低端设备自动降级动画。
6. **错误处理与降级**
   - 网络异常、认证失效、数据加载失败等统一错误提示。
   - 支持自动重试、手动重试。
7. **多端同步与缓存**
   - 认证等数据多端同步，优先BroadcastChannel，降级localStorage事件。
   - 缓存失效自动刷新，支持分片、签名、过期、清理。

## 三、主要流程
1. **初始化流程**
   - 检查认证状态 → 初始化全局状态 → 渲染主页UI → 注册事件监听。
2. **认证切换流程**
   - 用户点击登出 → 清理缓存 → 跳转登录页。
   - 匿名用户升级 → 迁移资产与进度 → 刷新UI。

## 四、UI与交互
- 所有UI组件命名用 ui-home-* 前缀，样式全部放 public/styles/，页面样式放 pages/，组件样式放 components/。
- 主页结构包括：主标题区、神秘声音与玩家选项区、主操作按钮区、底部登录注册入口。
- mysterious-voice.js 负责主提示、打字动画、声波特效。
- player-choices.js 负责玩家选项按钮、交互。
- 按钮、面板全部组件化，事件驱动，禁止直接操作业务数据。
- 支持键盘、触屏、鼠标等多种交互方式。
- 认证等变更全部通过事件系统驱动UI刷新。

## 五、数据与接口
- 用户信息通过统一接口获取，优先本地缓存，失效时自动远程拉取。
- 所有数据结构需包含时间戳、签名、版本号，支持多端同步。
- 认证等接口需支持异常处理和降级。

## 六、异常与降级
- 网络异常、认证失效、数据加载失败等统一通过UI组件提示，支持重试。
- 低端设备自动降级动画、简化UI，保证主流程可用。
- 所有异步操作必须捕获异常，详细日志便于排查。

## 七、兼容与安全
- 兼容主流浏览器，低端设备自动降级。
- 所有敏感数据加密存储，添加签名和时间戳。
- 用户切换、登出时彻底清理所有相关缓存和监听器。

## 八、伪代码与典型场景
```js
// 初始化新主页
InitNewHome();
// 等待认证和缓存就绪
await waitForAuthReady();
// 创建新主页管理器
window.newHomeManager = new NewHomeManager();
await window.newHomeManager.init();
// 监听登出
window.newHomeManager.on('logout', handleLogout);
// 错误处理
window.newHomeManager.on('error', showErrorScreen);
```

## 九、非功能性需求
- 性能：主页加载时间<2s，UI交互无明显卡顿。
- 可维护性：所有代码、样式、资源分目录管理，禁止大杂烩。
- 可扩展性：支持后续增加新入口等。

## 十、约束与禁止事项
- 禁止复用旧主页目录、文件、命名空间、样式。
- 禁止内联样式和硬编码颜色、字体。
- 所有实现必须严格遵守 mdc 规则。
